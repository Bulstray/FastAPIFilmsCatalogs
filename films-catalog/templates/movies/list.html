{% extends 'base.html' %}

{% block title %}
    All Movies
{% endblock %}

{% block main %}
    <h1>Movies list</h1>

    {% if movies %}
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                <tr>
                    <th scope="col">slug</th>
                    <th scope="col">Movie</th>
                    <th scope="col">Description</th>
                    <th scope="col">Url</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody>

                {% for movie in movies %}
                    <tr>
                        <td><code>{{ movie.slug }}</code></td>
                        <td>{{ movie.name }}</td>
                        <td>
                            {% if movie.description %}
                                {{ movie.description }}
                            {% else %}
                                <code>-</code>
                            {% endif %}
                        </td>
                        <td><a href="{{ movie.url }}" target="_blank">{{ movie.url }}</a></td>
                        <td>
                            <div class="btn-group" role="group" aria-label="Movies actions">
                                <a href="{{ url_for('movies:update-view', slug=movie.slug) }}" class="btn btn-primary">Edit</a>
                                <button
                                        type="button"
                                        class="btn btn-outline-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modal-confirm-delete-{{ movie.slug }}"
                                >
                                    Delete
                                </button>
                            </div>

                            <!-- Button trigger modal -->


                            <!-- Modal -->
                            <div class="modal fade"
                                 id="modal-confirm-delete-{{ movie.slug }}"
                                 data-bs-backdrop="static"
                                 data-bs-keyboard="false"
                                 tabindex="-1"
                                 aria-labelledby="modal-confirm-delete-{{ movie.slug }}-label"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5"
                                                id="#modal-confirm-delete-{{ movie.slug }}-label">Confirm delete Movie
                                                <code>{{ movie.slug }}</code></h1>
                                            <button type="button"
                                                    class="btn-close"
                                                    data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            Are you sure want to delete movie
                                            <code>{{ movie.slug }}</code> that links to
                                            <a href="{{ movie.name }}">movie.name</a>?
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                Close
                                            </button>

                                            <button
                                                    hx-delete="{{ url_for('movies:delete', slug=movie.slug) }}"
                                                    hx-target="closest tr"
                                                    hx-swap="outerHTML swap:0.5s"
                                                    type="submit"
                                                    class="btn btn-danger"
                                                    data-bs-dismiss="modal"
                                            >Permanently delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div>
            <a class="btn btn-outline-primary"
               href="{{ url_for('movies:create-view') }}">Create_new</a>
        </div>

    {% else %}
        <h2>No movies yet</h2>
        <h3>You can <a href="{{ url_for('movies:create-view') }}">create a new one</a></h3>
    {% endif %}

    <style>
        tr.htmx-swapping td {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js"
            integrity="sha384-ZBXiYtYQ6hJ2Y0ZNoYuI+Nq5MqWBr+chMrS/RkXpNzQCApHEhOt2aY8EJgqwHLkJ"
            crossorigin="anonymous">
    </script>


{% endblock %}
